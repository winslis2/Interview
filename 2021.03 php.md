# 2021.03 PHP面试准备

- 哪些方法可以将网页上的图片下载到本地硬盘?

> 1、curl
>
> 2、file_get_contents()

- PHP中如何判断一个字符串是否是合法的日期模式

  ```php
  function checkDateTime($date string) :bool {
    if(date('Y-m-d H:i:s', strtotime($date)) == $date) {
      return true;
    }else {
      return false;
    }
  }
  ```

- 编写一个可以去除字符串前后空白的函数

  > $test = preg_replace('/^(&nbsp;|\s)*|(&nbsp;|\s)*$/', '', $test);   |在正则表达式中是或的意思

- 怎么让别人可以通过网络访问到自己本地的项目?

  > 可以使用 一些 内网穿透的工具
  >
  > 譬如Ngrok、花生壳 ，以实现讲内网地址 映射到外网给别人访问

- 判断函数的输出

  ```php
  function add():int {
  	 static $num = 1;
  	 $num++;
  	 return $num;
  }
  $res = add()+add()+add() //9 = 2+3+4
    
  ```

- 秒杀怎么做?

  >做秒杀的话架构大于开发, 不同场景、数据量、服务器台数、团队本身都会造成不同的做法和架构
  >
  >秒杀的关键点在与瞬时的高并发分流、库存同步(防止超卖)、恶意防刷
  >
  >	1、库存同步可以使用etcd做集群
  >
  >​		2、用户下单可以使用MQ,进行多消费者分流
  >
  >​        3、 限流可以使用nginx自带的限流配置,使用的是ngx_http_limit_req_module\ngx_http_conn_module
  >
  >​		4、Java的话可以使用Gateway网关
  >
  >然后讲一个自己遇到过的问题, 如数据库死锁、 用户下订单的时候SQL反应过慢等,可以发挥想象力,面试就是讲故事的过程
  >
  >
  >
  >回答问题要避开锋芒,同时听起来又很饱满,感觉你很会
  >
  >
  >
  >除了谈技术,还要谈看法,譬如流浪削峰是为了啥?为了限制用户访问?并不是,而是为了场景的整体稳定性,一旦发生瓶颈的一种退而求其次的思想,也就是哪怕一部分人秒杀成功,也比服务器宕机或恶意秒掉商品好
  >
  >
  >
  >为啥要使用设计模式?对象来对象去?是为了逼格?直接写函数企业不是更快吗? 这也是一种思想:提高面向对象的代码封装,降低了性能,但提高了代码的可读性,技术是一个两害取其轻的过程,孰轻孰重,根据业务场景进行考量
  >
  >总结怎么回答这一类的问题:
  >
  >1、这些问题有哪些点
  >
  >2、用什么手段保障
  >
  >3、自己遇到过什么问题
  >
  >4、一旦保证不了,我们怎么退而求其次
  >
  >过程:秒杀的时候先判断库存,如果有库存可以返回给用户创建一个订单信息,然后进入MQ,这个时候前端可以显示一个正在创建中,也可能创建失败
  >
  >

  >上述点都没做过怎么办?其实很正常,谁真正做过千万亿级别的秒杀  还是要背,就是高考一样死记硬背,每天反复练习自己的口才 ,录制成音频反复听,找自己口才的猥琐点,改进之
  >
  >

- 当面试官提出一个问题时,不要着急回答,想下面试官想要什么样的答案

- 为什么TCP是三次握手而不是两次或四次

  > 这个问题很多人都会想到一个问好的类比,但是这往往犯了十个类比九个错,类比往往无法描述问题本身,三次握手的本质目的是是建立可靠高效的传输,我简单的说下三次握手的过程,客户端发送一个序列号给服务端,服务端收到后进行ac k+1确认并发送自己的序列号给客户端,客户端收到后根据第二次的服务端发送的报文生成新的报文,服务端确认之后就进行链接了,我先说下为什么两次不行,当遇到网络堵塞的时候,发送方连续发送多次建立连接的请求，如果 TCP 建立连接只能通信两次，那么接收方只能选择接受或者拒绝发送方发起的请求，它并不清楚这一次请求是不是由于网络拥堵而早早过期的连接,这就会造成链接不可靠,如果是四次的话也可以,但是没那么高效

- Redis如何实现高可用?

  > 需要Redis开启主从复制,一个master节点,多个子节点,同时还需要设置哨兵模式,防止主节点宕机,哨兵会推选出新的主节点从而保证集群的稳定

- http协议要知道的

  > http是无状态的，http常见的状态码有200:请求成功、301永久转移，404未找到，302临时转移，401请求要求用户进行验证，500服务器内部错误，403服务器拒绝

- ws协议原理

  Web socket 是长链接，ws协议是基于TCP的，首先客户端发送一个握手包，握手包的报文必须符合HTTP报文格式，然后服务端会建立一个握手包给客户端，客户端会有一个key给服务器，服务器会使用固定的加密规则加密，然后返会给客户端进行解密， 可以自己用PHP手写一个WS类实现ws协议 ，也可以使用workman，swoole实现

- MySQL为什么默认的存储引擎是B+

  > 哈希虽然能够提供 O(1) 的单数据行操作性能，但是对于范围查询和排序却无法很好地支持，最终导致全表扫描；
  > B 树能够在非叶节点中存储数据，但是这也导致在查询连续数据时可能会带来更多的随机 I/O，而 B+ 树的所有叶节点可以通过指针相互连接，能够减少顺序遍历时产生的额外随机 I/O；

- Redis为什么使用跳表的数据结构

  > Redis的Zset数据类型是使用，跳表也就是建立多级索引，他的查找、删除、添加复杂度是O(logn)，而且针对Zset结构多做范围操作，跳表的实现难度相对较小，占用内存低，红黑树在操作插入和删除的时候要处理子数，跳表只需处理相邻的节点即可

- 为什么Redis选择单线程模型

  > Redis 选择使用单线程模型处理客户端的请求主要还是因为 CPU 不是 Redis 服务器的瓶颈，所以使用多线程模型带来的性能提升并不能抵消它带来的开发成本和维护成本，系统的性能瓶颈也主要在网络 I/O 操作上；在4.0版本后引入多线程模型，而 Redis 引入多线程操作也是出于性能上的考虑，对于一些大键值对的删除操作，通过多线程非阻塞地释放内存空间也能减少对 Redis 主线程阻塞的时间，提高执行的效率。
  >
  > Redis 虽然使用单线程模型处理用户的请求，但是它却使用 I/O 多路复用机制**并发**处理来自客户端的多个连接，同时等待多个连接发送的请求。

- 一个表有四个字端id student_id class_id num 怎么找出班级下所有分数相同的学生？

  > Select group_concat(id),num from stu where class_id = 1 group by num;  //group_concat() 可以理解为concat的加强版，group可以进行分组去重，默认的大小是1024，可以修改

- 分布式系统的CAP理论

  > 一个分布式系统最多只能同时满足一致性（Consistency）、可用性（Availability）和分区容错性（Partition tolerance）这三项中的两项。

- Raft 算法

  > 

- 接口幂等

  